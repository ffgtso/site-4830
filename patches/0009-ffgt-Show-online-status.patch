From e5defb2738d9e5241cd5b566d4321c763579ef91 Mon Sep 17 00:00:00 2001
From: wusel <wusel+src@uu.org>
Date: Mon, 17 Jun 2024 00:30:09 +0200
Subject: [PATCH] 4830.org show if online

---
 .../files/lib/gluon/config-mode/view/theme/layout.html   | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/package/gluon-config-mode-theme/files/lib/gluon/config-mode/view/theme/layout.html b/package/gluon-config-mode-theme/files/lib/gluon/config-mode/view/theme/layout.html
index 9633531a..50c16617 100644
--- a/package/gluon-config-mode-theme/files/lib/gluon/config-mode/view/theme/layout.html
+++ b/package/gluon-config-mode-theme/files/lib/gluon/config-mode/view/theme/layout.html
@@ -7,10 +7,18 @@ SPDX-FileCopyrightText: 2008-2010 Jo-Philipp Wich <xm@subsignal.org>
 	local pretty_hostname = require "pretty_hostname"
 	local uci  = require("simple-uci").cursor()
 	local util = require "gluon.util"
+	local unistd = require 'posix.unistd'
 
 	local hostname = pretty_hostname.get(uci)
 	local release = util.readfile("/lib/gluon/release")
 
+	local onlinestate = "offline"
+	if unistd.access('/tmp/is_online') then
+		onlinestate=util.readfile("/tmp/is_online")
+		onlinestate=onlinestate:gsub('\.\n', '')
+		onlinestate=onlinestate:gsub("ipv", "IPv")
+	end
+
 	local root = node()
 	local rnode = node(unpack(request))
 
@@ -107,6 +115,7 @@ SPDX-FileCopyrightText: 2008-2010 Jo-Philipp Wich <xm@subsignal.org>
 				<% if release then %>
 				/ <%|release%>
 				<% end %>
+				&nbsp;&nbsp;&nbsp; (<%|onlinestate%>)
 			</a>
 		</div>
 
-- 
2.30.2


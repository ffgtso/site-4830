From f784dda61df4ff6478aacfa61289a4a75aba5e00 Mon Sep 17 00:00:00 2001
From: wusel <wusel+src@uu.org>
Date: Sun, 16 Jun 2024 23:24:40 +0200
Subject: [PATCH] Block Ports 80, 22

---
 .../files/lib/gluon/setup-mode/rc.d/S50uhttpd      | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/package/gluon-config-mode-core/files/lib/gluon/setup-mode/rc.d/S50uhttpd b/package/gluon-config-mode-core/files/lib/gluon/setup-mode/rc.d/S50uhttpd
index efd1d612..a7a5839e 100755
--- a/package/gluon-config-mode-core/files/lib/gluon/setup-mode/rc.d/S50uhttpd
+++ b/package/gluon-config-mode-core/files/lib/gluon/setup-mode/rc.d/S50uhttpd
@@ -7,6 +7,20 @@ USE_PROCD=1
 UHTTPD_BIN="/usr/sbin/uhttpd"
 
 start_service() {
+	for i in 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 203.0.113.0/24
+	do
+		/usr/sbin/iptables -I INPUT -s $i -p tcp --dport 22 -j ACCEPT ||:
+		/usr/sbin/iptables -I INPUT -s $i -p tcp --dport 80 -j ACCEPT ||:
+	done
+	/usr/sbin/iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 22 -j DROP ||:
+	/usr/sbin/iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 80 -j DROP ||:
+	for i in fc00::/7 fe80::/10
+	do
+		/usr/sbin/ip6tables -I INPUT -s $i -p tcp --dport 22 -j ACCEPT ||:
+		/usr/sbin/ip6tables -I INPUT -s $i -p tcp --dport 80 -j ACCEPT ||:
+	done
+	/usr/sbin/ip6tables -A INPUT -s 0/0 -p tcp --dport 22 -j DROP ||:
+	/usr/sbin/ip6tables -A INPUT -s 0/0 -p tcp --dport 80 -j DROP ||:
 	procd_open_instance
 	procd_set_param respawn
 	procd_set_param command "$UHTTPD_BIN" -f -h /lib/gluon/config-mode/www -x /cgi-bin -A 1 -R -p 0.0.0.0:80
-- 
2.30.2

